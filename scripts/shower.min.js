/**
 * Core for Shower HTML presentation engine
 * shower-core v2.1.0, https://github.com/shower/core
 * @copyright 2010â€“2018 Vadim Makeev, http://pepelsbey.net/
 * @license MIT
 */
var shower=function(a){"use strict";var b=Math.max;(function(){var a=KeyboardEvent.prototype,b=Object.getOwnPropertyDescriptor(a,"key");if(b){var c={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};Object.defineProperty(a,"key",{get:function(){var a=b.get.call(this);return c.hasOwnProperty(a)?c[a]:a}})}})();class c{constructor(a={}){this._data=a,this._preventDefault=!1,this._stopPropagation=!1}get(a){return this._data[a]}preventDefault(){return this._preventDefault=!0,this._preventDefault}defaultPrevented(){return this._preventDefault}stopPropagation(){return this._stopPropagation=!0,this._stopPropagation}isPropagationStopped(){return this._stopPropagation}}class d{constructor(a){this.events=a,this._listeners=[]}on(a,b,c,d){return[].concat(a).forEach((a)=>{this._listeners.push(a,b,c,d)}),this.events.on(a,b,c,d),this}off(a,b,c){return[].concat(a).forEach((a)=>{this._removeListener(a,b,c)}),this}offAll(){for(let a=0;a<this._listeners.length;a+=3)this.events.off(this._listeners[a],this._listeners[a+1],this._listeners[a+2]);return this._listeners=[],this}_removeListener(a,b,c){for(let d=this._listeners.indexOf(a);-1!==d;)this._listeners[d+1]===b&&this._listeners[d+2]===c&&(this._listeners.splice(d,3),this.events.off(a,b,c)),d=this._listeners.indexOf(a,d)}}const e=(a,b,d)=>new c(Object.assign({type:a,target:d},b)),f=(a,b)=>{a.sort((c,a)=>c.priority-a.priority);for(const c of a){if(b.defaultPrevented())break;c.callback.call(c.context,b)}};class g{constructor(a={}){this._context=a.context,this._parent=a.parent,this._listeners={}}on(a,b,c,d=0){if("function"!=typeof b)throw new Error("Callback is not a function.");return[].concat(a).forEach((a)=>{this._addListener(a,b,c,d)}),this}off(a,b,c,d=0){return[].concat(a).forEach((a)=>{this._removeListener(a,b,c,d)}),this}once(a,b,c,d){const e=(f)=>{this.off(a,e,this,d),b.call(c,f)};return this.on(a,e,this,d),this}emit(a,b){b&&"function"==typeof b.get||(b=e(a,b,this._context)),b.isPropagationStopped()||(this._listeners.hasOwnProperty(a)&&f(this._listeners[a],b),this._parent&&!b.isPropagationStopped()&&this._parent.emit(a,b))}setParent(a){return this._parent=a,this}getParent(){return this._parent}group(){return new d(this)}_addListener(a,b,c,d){const e={callback:b,context:c,priority:d};this._listeners.hasOwnProperty(a)?this._listeners[a].push(e):this._listeners[a]=[e]}_removeListener(a,b,c,d){const e=this._listeners[a]||[],f=e.findIndex((a)=>a.callback===b&&a.context===c&&a.priority===d);-1===f||(e.splice(f,1),!e.length&&this._clearType(a))}_clearType(a){this._listeners.hasOwnProperty(a)&&delete this._listeners[a]}}const h=()=>{const a=1/b(document.body.clientWidth/innerWidth,document.body.clientHeight/innerHeight);return`scale(${a})`},i=(a)=>{document.body.style.transform=a};class j{constructor(a,b){this.events=new g({context:this,parent:a.events}),this._shower=a,this._element=b,this._isSlideMode=!1,this._key=`${a.options.sessionstore_key}-mode`,this._init(),this._setupListeners()}_init(){const{options:a}=this._shower,b=a.mode_full_classname,c=a.mode_list_classname,d=document.body.classList;d.contains(b)||"full"===sessionStorage[this._key]?this.enterSlideMode():d.add(c)}_setupListeners(){this._showerListeners=this._shower.events.group().on("slideadd",this._onSlideAdd,this).on("slideremove",this._onSlideRemove,this),window.addEventListener("resize",()=>{this.isSlideMode()&&i(h())})}getElement(){return this._element}enterSlideMode(){if(this._isSlideMode)return this;const a=document.body.classList,{options:b}=this._shower;return a.remove(b.mode_list_classname),a.add(b.mode_full_classname),sessionStorage[this._key]="full",i(h()),this._isSlideMode=!0,this.events.emit("modechange"),this}exitSlideMode(){if(!this._isSlideMode)return this;const a=document.body.classList,{options:b}=this._shower;return a.remove(b.mode_full_classname),a.add(b.mode_list_classname),sessionStorage[this._key]="list",i("none"),this.scrollToCurrentSlide(),this._isSlideMode=!1,this.events.emit("modechange"),this}isSlideMode(){return this._isSlideMode}scrollToCurrentSlide(){const a=this._shower.options.slides_selector,b=this._shower.options.slide_active_classname,c=document.querySelector(`${a}.${b}`);return console.log(`${a}.${b}`,c),c&&c.scrollIntoView(),this}_onSlideAdd(a){const b=a.get("slide");b.events.on("click",this.enterSlideMode,this)}_onSlideRemove(a){const b=a.get("slide");b.events.off("click",this.enterSlideMode,this)}}var k={container_selector:".shower",debug_mode:!1,debug_mode_classname:"debug",sessionstore_key:"shower",slides_selector:".shower .slide",mode_full_classname:"full",mode_list_classname:"list",slide_title_element_selector:"h2",slide_active_classname:"active",slide_visited_classname:"visited"};class l{constructor(a){this.events=new g({context:this,parent:a.events}),this._shower=a,this._currentSlideIndex=-1,this._setupListeners()}_setupListeners(){this._shower.events.group().on("slideadd",this._onSlideAdd.bind(this)).on("slideremove",this._onSlideRemove.bind(this)),this.events.group().on("prev",this._onPrev,this,100).on("next",this._onNext,this,100)}_onPrev(){this.go(this._currentSlideIndex-1)}_onNext(){this.go(this._currentSlideIndex+1)}prev(){return this.events.emit("prev"),this}next(){return this.events.emit("next"),this}first(){return this.go(0),this}last(){return this.go(this._shower.getSlidesCount()-1),this}go(a){"number"!=typeof a&&(a=this._shower.getSlideIndex(a));const b=this._shower.getSlidesCount();let c=this._currentSlide;return a!==this._currentSlideIndex&&a<b&&0<=a&&(c&&c.isActive()&&c.deactivate(),c=this._shower.get(a),!c.isActive()&&c.activate(),this._currentSlide=c,this._currentSlideIndex=a,this.events.emit("activate",{index:a,slide:c})),this}getCurrentSlide(){return this._currentSlide}getCurrentSlideIndex(){return this._currentSlideIndex}_onSlideAdd(a){const b=a.get("slide");b.events.on("activate",this._onSlideActivate,this)}_onSlideRemove(a){const b=a.get("slide");b.events.off("activate",this._onSlideActivate,this)}_onSlideActivate(a){const b=a.get("slide"),c=this._shower.getSlideIndex(b);this.go(c)}}class m{constructor(a){this._shower=a,this._set=new Set}add(a,b,c){if(this._set.has(a))throw new Error(`Plugin "shower-${a}" already exist.`);return c||(c=this._shower.options[`plugin_shower-${a}`]||{}),b.hasOwnProperty("prototype")?new b(this._shower,c):b(this._shower,c),this}}class n{static create(a={}){const{content:b="",contentType:c="slide"}=a,d=document.createElement("section");return d.innerHTML=b,d.classList.add(c),new this(d)}constructor(a,b){this.events=new g,this.options=Object.assign({title_element_selector:k.slide_title_element_selector,active_classname:k.slide_active_classname,visited_classname:k.slide_visited_classname},b),this._element=a,this._parent=null,this._parentElement=null,this._init()}_init(){const{parentNode:a}=this._element;a?this._parentElement=a:this.setParentElement(a)}setParent(a){this._parent===a||(this._clearListeners(),this._parent=a,this._parent&&this._setupListeners())}getParent(){return this._parent}setParentElement(a){this._parentElement===a||(this._parentElement=a,a.appendChild(this._element))}getParentElement(){return this._parentElement}getElement(){return this._element}setTitle(a){const b=this.options.title_element_selector;let c=this._element.querySelector(b);c||(c=document.createElement(b),this._element.insertBefore(c,this._element.firstChild)),c.innerHTML=a}getTitle(){const a=this.options.title_element_selector,b=this._element.querySelector(a);return b&&b.textContent}getContent(){return this._element.innerHTML}_setupListeners(){this._slideListeners=this._parent.events.group().on("activate",this._onSlideActivate,this).on("deactivate",this._onSlideDeactivate,this),this._onSlideClick=this._onSlideClick.bind(this),this._element.addEventListener("click",this._onSlideClick)}_clearListeners(){this._slideListeners&&this._slideListeners.offAll(),this._element.removeEventListener("click",this._onSlideClick)}_onSlideActivate(){this._element.classList.add(this.options.active_classname)}_onSlideDeactivate(){const a=this._element.classList;a.remove(this.options.active_classname),a.add(this.options.visited_classname)}_onSlideClick(){this.events.emit("click")}}class o{constructor(a,b,c){this.events=new g,this.options=Object.assign({},b),this.layout=null,this.state=Object.assign({visited:0},c),this._content=a,this._isActive=!1,this.init()}init(){this.layout="string"==typeof this._content?n.create({content:this._content}):new n(this._content,this.options),this.layout.setParent(this),this._setupListeners()}destroy(){this._clearListeners(),this._isActive=null,this.options=null,this.layout.destroy()}activate(){return this._isActive=!0,this.state.visited++,this.events.emit("activate",{slide:this}),this}deactivate(){return this._isActive=!1,this.events.emit("deactivate",{slide:this}),this}isActive(){return this._isActive}isVisited(){return 0<this.state.visited}getTitle(){return this.layout.getTitle()}setTitle(a){return this.layout.setTitle(a),this}getId(){return this.layout.getElement().id}getContent(){return this.layout.getContent()}_setupListeners(){this.layoutListeners=this.layout.events.group().on("click",this._onSlideClick,this)}_clearListeners(){this.layoutListeners.offAll()}_onSlideClick(){this.activate(),this.events.emit("click",{slide:this})}}const p=(a,b)=>{a.id||(a.id=b+1)};var q=(a,b)=>{const c=[...a.querySelectorAll(b)].filter((a)=>!a.hidden);return c.forEach(p),c.map((a)=>new o(a))};const r=(a)=>-1!==a.tabIndex,s=(a)=>a.ctrlKey||a.altKey||a.metaKey;const t=["s","m","h"],u=(a)=>t.some((b)=>a.includes(b)),v=(a)=>t.map((b)=>a.match(`(\\S+)${b}`)).map((a)=>a&&a[1]),w=(a)=>`::${a}`.split(":").reverse(),x=60;var y=(a)=>{if(!a)return 0;const c=u(a)?v(a):w(a);let[d,e,f]=c.map(Number);return d+=e*x,d+=f*(60*x),b(1e3*d,0)};const z="undefined"!=typeof showerOptions,A=z?showerOptions:{},B=A.shower_selector||k.container_selector,C=document.querySelector(B);if(!C)throw new Error(`Shower container with selector ${B} not found.`);const D=!("auto_init"in A)||A.auto_init;return(z&&D||"false"!==C.dataset.autoInit)&&(!z&&["debug-mode","slides-selector"].forEach((a)=>{const b=C.getAttribute(`data-${a}`);null!==b&&(A[a.replace(/-/g,"_")]=b)}),a.shower=new class{constructor(a,b){this.events=new g({context:this}),this.options=Object.assign({},k,b);let c=a||this.options.container_selector;"string"==typeof c&&(c=document.querySelector(c)),this.player=new l(this),this.container=new j(this,c),this._slides=[],this._initSlides(),this.options.debug_mode&&(document.body.classList.add(this.options.debug_mode_classname),console.info("Debug mode: on")),this.plugins=new m(this)}destroy(){this.events.emit("destroy"),this.container.destroy(),this.player.destroy(),this._slides=[]}add(a){return[].concat(a).forEach((a)=>{this._addSlide(a)}),this}remove(a){const b="number"==typeof a?a:this._slides.indexOf(a);if(!(b in this._slides))throw new Error("Slide not found");const[c]=this._slides.splice(b,1);return this.events.emit("slideremove",{slide:c}),this}get(a){return this._slides[a]}getSlides(){return this._slides.slice()}getSlidesCount(){return this._slides.length}getSlideIndex(a){return this._slides.indexOf(a)}_initSlides(){const a=q(this.container.getElement(),this.options.slides_selector);this.add(a)}_addSlide(a){this._slides.push(a),this.events.emit("slideadd",{slide:a})}}(C,A),a.shower.plugins.add("keys",(a)=>{const{container:b,player:c}=a,d=b.getElement();d.addEventListener("keydown",(a)=>{a.defaultPrevented||r(a.target)||(e(a),f(a))});const e=(a)=>{switch(a.key.toUpperCase()){case"ENTER":if(a.metaKey&&!b.isSlideMode()){a.shiftKey&&(a.preventDefault(),c.first());break}a.preventDefault(),a.shiftKey?c.prev():c.next();break;case"PAGEUP":case"ARROWUP":case"ARROWLEFT":case"H":case"K":case"P":s(a)||(a.preventDefault(),c.prev({cancelable:a.shiftKey}));break;case"PAGEDOWN":case"ARROWDOWN":case"ARROWRIGHT":case"L":case"J":case"N":s(a)||(a.preventDefault(),c.next({cancelable:a.shiftKey}));break;case" ":!s(a)&&b.isSlideMode()&&(a.preventDefault(),a.shiftKey?c.prev():c.next());break;case"HOME":a.preventDefault(),c.first();break;case"END":a.preventDefault(),c.last();}},f=(a)=>{switch(a.key.toUpperCase()){case"ESCAPE":b.isSlideMode()&&(a.preventDefault(),b.exitSlideMode());break;case"ENTER":a.metaKey&&!b.isSlideMode()&&(a.preventDefault(),b.enterSlideMode());break;case"P":a.metaKey&&a.altKey&&!b.isSlideMode()&&(a.preventDefault(),b.enterSlideMode());break;case"F5":a.shiftKey&&!b.isSlideMode()&&(a.preventDefault(),b.enterSlideMode());}}}).add("title",(a)=>{const{title:b}=document,c=()=>{if(a.container.isSlideMode()){const c=a.player.getCurrentSlide(),d=c.getTitle();if(d)return void(document.title=`${d} ${"\u2014"} ${b}`)}document.title=b};a.player.events.on("activate",c),a.container.events.on("modechange",c)}).add("location",(a)=>{const{player:b}=a,c=()=>{const b=location.hash.slice(1);return a.getSlides().find((a)=>a.getId()===b)};b.events.on("activate",(a)=>{location.hash=a.get("slide").getId()});const d=()=>{const d=c();d?b.go(d):!b.getCurrentSlide()&&(a.container.isSlideMode()||location.hash)&&b.first()};addEventListener("hashchange",d),d()}).add("next",(a,b)=>{const c=b.selector||".next",d=a.options.slide_active_classname;let e,f;const g=()=>{e=h(),f=i();const b=a.player.getCurrentSlide();b.state.innerStepsCount=e.length},h=()=>{const{layout:b}=a.player.getCurrentSlide(),d=b.getElement();return[...d.querySelectorAll(c)]},i=()=>e.filter((a)=>a.classList.contains(d)).length,j=()=>{e.forEach((a,b)=>{a.classList.toggle(d,b<f)})},k=(b)=>{const c=a.container.isSlideMode()&&f<e.length;c&&(b.preventDefault(),f++,j())},l=(b)=>{const c=a.container.isSlideMode()&&0<f&&f<e.length;c&&(b.preventDefault(),f--,j())};-1!==a.player.getCurrentSlideIndex()&&g(),a.player.events.group().on("activate",g).on("next",k).on("prev",l)}).add("progress",(a,b)=>{const c=a.container.getElement(),d=b.selector||".progress",e=c.querySelector(d);if(e){e.setAttribute("role","progressbar"),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuemax",100);const b=()=>{const b=a.player.getCurrentSlideIndex();if(-1!==b){const c=a.getSlidesCount(),d=100*(b/(c-1));e.style.width=`${d}%`,e.setAttribute("aria-valuenow",d),e.setAttribute("aria-valuetext",`Slideshow progress: ${d}%`)}};a.player.events.on("activate",b),b()}}).add("timer",(a)=>{let b;const c=()=>{a.player.next()},d=(a,d)=>{const{innerStepsCount:e}=a.state;if(e){b=setInterval(c,d/(e+1))}else b=setTimeout(c,d)},e=()=>{clearTimeout(b)},f=()=>{if(e(),!!a.container.isSlideMode()){const b=a.player.getCurrentSlide();if(!(1<b.state.visited)){const a=b.layout.getElement(),c=y(a.dataset.timing);c&&d(b,c)}}},g=a.container.getElement();g.addEventListener("keydown",(a)=>{a.defaultPrevented||e()}),a.player.events.on("activate",f),-1!==a.player.getCurrentSlideIndex()&&f()}).add("touch",class{constructor(a){this._shower=a,this._setupListeners()}_setupListeners(){this._showerListeners=this._shower.events.group().on("add",this._onSlideAdd.bind(this)).on("destroy",this._destroy.bind(this)),this._bindedTouchStart=this._onTouchStart.bind(this),this._bindedTouchMove=this._onTouchMove.bind(this),this._shower.getSlides().forEach(this._addTouchStartListener,this),document.addEventListener("touchmove",this._bindedTouchMove,!0)}_onSlideAdd(a){const b=a.get("slide");this._addTouchStartListener(b)}_addTouchStartListener(a){const b=a.layout.getElement();b.addEventListener("touchstart",this._bindedTouchStart)}_onTouchStart(a){const b=this._getSlideByElement(a.currentTarget);if(b)if(this._shower.container.isSlideMode()){if(r(a.target))return;a.preventDefault();const[{pageX:b}]=a.touches;b>innerWidth/2?this._shower.player.next():this._shower.player.prev()}else b.activate()}_onTouchMove(a){this._shower.container.isSlideMode()&&a.preventDefault()}_getSlideByElement({id:a}){const b=this._shower.getSlides();return b.find((b)=>b.getId()===a)}_destroy(){this._shower=null,this._clearListeners()}_clearListeners(){this._showerListeners.offAll(),this._shower.getSlides().forEach(this._removeTouchStartListener,this),document.removeEventListener("touchmove",this._bindedTouchMove)}_removeTouchStartListener(a){const b=a.layout.getElement();b.removeEventListener("touchstart",this._bindedTouchStart)}}).add("a11y",(a)=>{const b=document.createElement("section");b.className="region",b.setAttribute("role","region"),b.setAttribute("aria-live","assertive"),b.setAttribute("aria-relevant","all"),b.setAttribute("aria-label","Slide Content: Auto-updating"),document.body.appendChild(b);const c=()=>{a.container.isSlideMode()?document.body.setAttribute("role","application"):document.body.removeAttribute("role")};a.container.events.on("modechange",c),c();const d=()=>{const c=a.player.getCurrentSlide();c&&(b.innerHTML=c.getContent())};a.player.events.on("activate",d),d()})),a}({});
